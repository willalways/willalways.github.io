---
layout: post
title: 渗透测试之方法论篇
category: 网络安全
keywords: 渗透测试, 方法论, Penetration, Methodology, 2019
---

# 前言
方法论顾名思义就是针对执行某事方法的论述。每个人做事都可能有自己的方法，只不过不会体系化和结构化。<br>
经过前辈的整理和总结，梳理出一套普遍适用的方法论，说到普遍适用也是相对而言的，所以说也没有完全正确的方法论。<br>
渗透测试方法论也就是教你怎么做好渗透测试的方法。下面我们看看这些方法。<br>
虽说安全测试和渗透测试还是有区别，但是本文不做细致区别，可认为两个概念基本一致。

# 著名的安全评估方法论
+ 开源安全测试方法论<br>OSSTMM: Open Source Security Testing Methodology Manual
+ 信息系统安全评估框架<br>ISSAF: Information Systems Security Assessment Framework>
+ CREST Penetration Testing Guide
+ Technical Guide to Information Security Testing and Assessment (NIST800-115)
+ OWASP测试指南项目<br>OWASP Testing Guide Project
+ 渗透测试执行标准<br>PTES: Penetraion Testing Execution Standard

# 方法论简介
## OSSTMM
暂未花时间学习该方法，后续再补充。<br>

从下面引用的话可以猜测出该方法是比较高层的方法，相比于可以直接参考执行渗透测试这类比较底层的方法是有区别的。或者说直接用OSSTMM指导进行渗透测试并不是太合适。<br>

该方法引入RAV(Risk Assessment Value),输出报告采用STAR(Security Test Audit Report)。相对而言是个比较偏向于风险评估的测试方法。总体目标是确保每次评估进行得全面彻底，保证评估过程的一致性，可测性，可靠性。

该方法论把安全评估工作划分为4组：范围(Scope)，信道(Channel)，索引(Index)，矢量(Vector)
上述4个部分整合在一起，被称为审计范畴(Audit Scope)

TODO

引用参考文献【2】中针对OSSTMM的描述
> OSSTMM is a methodology to test the operational security of physical locations, workflow, human security testing, physical security testing, wireless security testing, telecommunication security testing, data networks security testing and compliance. <font color=#0099ff size=3 face="黑体">OSSTMM can be supporting reference of IOS 27001 instead of a hands-on penetration testing guide</font>.

OSSTMM includes the following key sections:
- Operational Security Metrics
- Trust Analysis
- Work Flow.
- Human Security Testing
- Physical Security Testing
- Wireless Security Testing
- Telecommunications Security Testing
- Data Networks Security Testing
- Compliance Regulations
- Reporting with the STAR (Security Test Audit Report)

## ISSAF
暂未花时间学习该方法，后续再补充。<br>

该方法论区别于OSSTMM，花很多笔墨编写了“TECHNICAL CONTROLS AND SECURITY ASSESSMENT”，这部分内容主要是针对相对独立的系统/模块进行安全评估的技术指导。对于渗透测试人员有非常高的参考价值。当前最新的ISSAF版本为[issaf0.2.1.pdf](https://epdf.pub/information-systems-security-assessment-framework-issaf-draft-021.html)

所以参考文献【1】中P48 有说“可同时结合OSSTMM和ISSAF两种理论评估企业环境的安全状况。”

TODO

引用参考文献【2】中针对ISSAF的描述
> The ISSAF is a very good reference source of penetration testing though Information Systems Security Assessment Framework (ISSAF) which is not an active community. It provides comprehensive step-by-step penetration testing technical guidance.

It covers the area below.
- Project Management
- Guidelines And Best Practices – Pre Assessment, Assessment And Post Assessment
- Assessment Methodology
- Review Of Information Security Policy And Security Organization
- Evaluation Of Risk Assessment Methodology
- Technical Control Assessment
- Technical Control Assessment - Methodology
- Password Security
- Password Cracking Strategies
- Unix /Linux System Security Assessment
- Windows System Security Assessment
- Novell Netware Security Assessment
- Database Security Assessment
- Wireless Security Assessment
- Switch Security Assessment
- Router Security Assessment
- Firewall Security Assessment
- etc.

## NIST800-115 && CREST Penetration Testing Guide
TODO

## OWASP Testing Guide v4
本方法是针对Web应用的测试指导，另外可查看参考文件【6】中的内容。

OWASP测试指南从以下几个方面进行覆盖
- Information Gathering
- Configuration and Development Management 
- Identity Management
- Authentication
- Authorization
- Session Management
- Input Validation
- Error Handling
- Weak Cryptography
- Businiess Logic
- Client Side


## PTES
Following are the main sections defined by the standard as the basis for penetration testing execution:

- Pre-engagement Interactions
- Intelligence Gathering
- Threat Modeling
- Vulnerability Analysis
- Exploitation
- Post Exploitation
- Reporting

上面7个环节覆盖了渗透测试的整个生命周期，从开始前期交互到最终输出报告。

我们把渗透测试流程中的人员分成甲方和乙方，乙方就是提供渗透测试的服务方，甲方是需要渗透测试的需求方。为了达成服务交易，甲方需要给乙方支付费用。

该方法主要描述了乙方在给甲方做渗透测试服务整个生命周期，应该怎么做。

### Pre-engagement Interactions
+ 范围
+ 指定开始日期和结束日期
+ 目标
+ 建立沟通渠道

Remember, a penetration test should not be confrontational. It should not be an activity to see if the tester can "hack" you. It should be about identifying the business risk associated with and attack.

Every penetration test should be goal-oriented. This is to say that the purpose of the test is to identify specific vulnerabilities that lead to a compromise of the business or mission objectives of the customer. It is not about finding un-patched systems. It is about identifying risk that will adversely impact the organization.

### Intelligence Gathering
+ 信息收集等级
+ OSINT
    + 被动信息收集
    + 主动信息收集
+ 确定保护机制

### Threat Modeling
assets and attacker (threat community/agent). Each one is respectively broken down into 
business assets and business processes and the threat communities and their capabilities.

高级威胁建模过程
+ 收集相关文档
+ 识别主要和次要资产并对其进行分类
+ 识别威胁和威胁社区并对其进行分类
+ 将威胁社区映射到主要和次要资产
		
根据PTES评估，内部托管的CRM应用程序可能在范围内。存储在后端数据库中的客户信息是一个易于识别的主要资产，因为它直接链接到范围内的应用程序。但是，通过查看数据库服务器的技术设计，还可以识别出存储在同一后端数据库服务器上的HR数据库是次要资产。攻击者可以使用CRM应用程序作为获取员工信息的垫脚石。在基本威胁建模练习中，某些威胁社区在映射到CRM应用程序主要资产时可能被识别为不相关，但通过映射到CRM应用程序次要资产时，可能情况就突然转变了。
	
### 动机建模
+ 利润（直接或间接）
+ 黑客行为
+ 直接怨恨
+ 乐趣/声誉
+ 长期访问合作 伙伴/连接 系统

## Vulnerability Analysis
自动化和手动
+ 网络/常规漏洞扫描程序
+ 基于服务
+ Banner Grabbing
+ Web应用程序扫描程序
+ 网络漏洞扫描程序/特定协议
+ 工具之间的相关性
+ 假阳性-手动连接与审查
+ 漏洞数据库 
+ 漏洞利用数据库和框架模块
+ 反汇编和代码分析
	
## Exploitation
如果前一阶段，漏洞分析得到了正确的执行，那么这个阶段应该精心规划并进行精确打击。主要重点是确定组织的主要切入点并确定高价值目标资产。
	
+ Anti-Virus
+ Encoding
+ Packing
+ Encrypting
+ Whitelist Bypass
+ Process Injection
+ Purely Memory Resident (内存驻留)
+ Human
+ Data Execution Prevention (DEP)
+ Address Space Layout Randomization
+ Web Application Firewall (WAF)
+ Tailored Exploits
+ Zero-Day Angle
+ Fuzzing
+ Source Code Analysis
+ Types of Exploits
    + Buffer Overflows
    + Return Oriented Programming
+ Traffic Analysis
+ Physical Access
+ Proximity Access (WiFi)
+ Attacking the User
+ Web Application Attacks 
+ Social-Engineering 
+ Physical Attack Avenues 
+ Memory Based Exploits (i.e. buffer/heap overflows, memory corruptions, use-after-free). 
+ Man in the Middle 
+ VLAN Hopping 
+ USB/Flash Drive deployment 
+ Reverse Engineering 
+ Zero-Day Angle Attacking 
+ the user Encryption Cracking 
+ Graphics Processing Unit (GPU) Cracking 
+ Traffic Analysis 
+ Firewire Routing protocols 
+ Phishing with Pretexting 
+ Employee Impersonation

	
> In the case of the exploitation phase, the biggest challenge is identifying the least path of resistance into the organization without detection and having the most impact on the organizations ability to generate revenue.
	
## Post Exploitation
+ 保护客户
+ 保护自己
+ 数据泄露
+ 后门维护
+ pivot
+ 清理

	
## Reporting
+ 执行摘要
    + 背景
    + 风险排名/简介
    + 漏洞统计展示
    + 建议摘要
    + 战略路线图
		
+ 技术报告	
    + 客户和渗透测试团队参与测试的人员
    + 联系信息
    + 参与测试的资产
    + 测试目标
    + 测试范围
    + 测试强度
    + 途径
    + 威胁/评分结构
    + 信息收集
    + 漏洞评估
    + 漏洞利用/漏洞确认
    + 后利用
    + 风险
    + 结论


# 参考/引用
【1】《Kali Linux 渗透测试的艺术》<br>
【2】[Penetration_testing_methodologies](https://www.owasp.org/index.php/Penetration_testing_methodologies)<br>
【3】[OSSTMM: Open Source Security Testing Methodology Manual](https://www.isecom.org/research.html#content5-9d)<br>
【4】*Information Systems Security Assessment Framework (ISSAF) draft 0.2.1*<br>
【5】*OWASP Testing Guide 4.0 Release*<br>
【6】[Cheat_Sheet:_Web_Application_Security_Frame](https://www.guidanceshare.com/wiki/Cheat_Sheet:_Web_Application_Security_Frame)<br>
【7】*The Penetration Testing Execution Standard Documentation Release 1.1*<br>
【8】[PTES Main Page](http://www.pentest-standard.org/index.php/Main_Page)<br>
【9】[CAPEC](https://capec.mitre.org/data/definitions/3000.html)<br>
