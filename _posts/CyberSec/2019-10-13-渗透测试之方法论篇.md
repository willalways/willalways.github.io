---
layout: post
title: 渗透测试之方法论篇
category: 网络安全
keywords: 渗透测试, 方法论, Penetration, Methodology, 2019
---

# 前言
方法论顾名思义就是针对执行某事方法的论述。每个人做事都可能有自己的方法，只不过不会体系化和结构化。<br>
经过前辈，专家的整理和总结，梳理出一套普遍适用的方法论，说到普遍适用也是相对而言的，所以说也没有完成正确的方法论。<br>
渗透测试方法论也就是教你怎么做好渗透测试的方法。下面我们看看这些方法。<br>
虽说安全测试和渗透测试还是有区别，但是本文不做细致区别，可认为两个概念基本一致。

# 著名的安全评估方法论
+ 开源安全测试方法论<br>OSSTMM: Open Source Security Testing Methodology Manual
+ 信息系统安全评估框架<br>ISSAF: Information Systems Security Assessment Framework>
+ CREST Penetration Testing Guide
+ Technical Guide to Information Security Testing and Assessment (NIST800-115)
+ OWASP测试指南项目<br>OWASP Testing Guide Project
+ 渗透测试执行标准<br>PTES: Penetraion Testing Execution Standard

# 方法论简介
## OSSTMM
暂未花时间学习该方法，后续再补充。<br>

从下面引用的话可以猜测出该方法是比较高层的方法，相比于可以直接参考执行渗透测试这类比较底层的方法是有区别的。或者说直接用OSSTMM指导进行渗透测试并不是太合适。<br>

该方法引入RAV(Risk Assessment Value),输出报告采用STAR(Security Test Audit Report)。相对而言是个比较偏向于风险评估的测试方法。总体目标是确保每次评估进行得全面彻底，保证评估过程的一致性，可测性，可靠性。

该方法论把安全评估工作划分为4组：范围(Scope)，信道(Channel)，索引(Index)，矢量(Vector)
上述4个部分整合在一起，被称为审计范畴(Audit Scope)

TODO

引用参考文献【2】中针对OSSTMM的描述
> OSSTMM is a methodology to test the operational security of physical locations, workflow, human security testing, physical security testing, wireless security testing, telecommunication security testing, data networks security testing and compliance. <font color=#0099ff size=3 face="黑体">OSSTMM can be supporting reference of IOS 27001 instead of a hands-on penetration testing guide</font>.

OSSTMM includes the following key sections:
- Operational Security Metrics
- Trust Analysis
- Work Flow.
- Human Security Testing
- Physical Security Testing
- Wireless Security Testing
- Telecommunications Security Testing
- Data Networks Security Testing
- Compliance Regulations
- Reporting with the STAR (Security Test Audit Report)

## ISSAF
暂未花时间学习该方法，后续再补充。<br>

该方法论区别于OSSTMM，花很多笔墨编写了“TECHNICAL CONTROLS AND SECURITY ASSESSMENT”，这部分内容主要是针对相对独立的系统/模块进行安全评估的技术指导。对于渗透测试人员有非常高的参考价值。当前最新的ISSAF版本为[issaf0.2.1.pdf](https://epdf.pub/information-systems-security-assessment-framework-issaf-draft-021.html)

所以参考文献【1】中P48 有说“可同时结合OSSTMM和ISSAF两种理论评估企业环境的安全状况。”

TODO

引用参考文献【2】中针对ISSAF的描述
> The ISSAF is a very good reference source of penetration testing though Information Systems Security Assessment Framework (ISSAF) which is not an active community. It provides comprehensive step-by-step penetration testing technical guidance.

It covers the area below.
- Project Management
- Guidelines And Best Practices – Pre Assessment, Assessment And Post Assessment
- Assessment Methodology
- Review Of Information Security Policy And Security Organization
- Evaluation Of Risk Assessment Methodology
- Technical Control Assessment
- Technical Control Assessment - Methodology
- Password Security
- Password Cracking Strategies
- Unix /Linux System Security Assessment
- Windows System Security Assessment
- Novell Netware Security Assessment
- Database Security Assessment
- Wireless Security Assessment
- Switch Security Assessment
- Router Security Assessment
- Firewall Security Assessment
- etc.

## NIST800-115 && CREST Penetration Testing Guide
TODO

## OWASP Testing Guide v4
本方法是针对Web应用的测试指导，另外可查看参考文件【6】中的内容。

OWASP测试指南从以下几个方面进行覆盖
- Information Gathering
- Configuration and Development Management 
- Identity Management
- Authentication
- Authorization
- Session Management
- Input Validation
- Error Handling
- Weak Cryptography
- Businiess Logic
- Client Side

该方法给每个测试点编号，并归类到上述测试中，达到测试覆盖的目的。
单次测试不一定要覆盖所有的测试面，但是应该根据预先做好评估，选择风险高的测试面进行测试，选中测试面后，测试点都要覆盖到，才能达到测试的效果。

|测试面|测试点|
|-|-|
|Information Gathering|Conduct Search Engine Discovery and Reconnaissance for Information Leakage (OTG-INFO-001)<br><br>Fingerprint Web Server (OTG-INFO-002)<br><br>Review Webserver Metafiles for Information Leakage (OTG-INFO-003)<br><br>Enumerate Applications on Webserver (OTG-INFO-004)<br><br>Review Webpage Comments and Metadata for Information Leakage (OTG-INFO-005)<br><br>Identify application entry points (OTG-INFO-006)<br><br>Map execution paths through application (OTG-INFO-007)<br><br>Fingerprint Web Application Framework (OTG-INFO-008)<br><br>Fingerprint Web Application (OTG-INFO-009)<br><br>Map Application Architecture (OTG-INFO-010)|
|Configuration and Development Management|Test Network/Infrastructure Configuration (OTG-CONFIG-001)<br><br>Test Application Platform Configuration (OTG-CONFIG-002)<br><br>Test File Extensions Handling for Sensitive Information (OTG-CONFIG-003)<br><br>Review Old, Backup and Unreferenced Files for Sensitive Information (OTG-CONFIG-004) <br><br>Enumerate Infrastructure and Application Admin Interfaces (OTG-CONFIG-005)<br><br>Test HTTP Methods (OTG-CONFIG-006)<br><br>Test HTTP Strict Transport Security (OTG-CONFIG-007)<br><br>Test RIA cross domain policy (OTG-CONFIG-008)|
|Identity Management|Test Role Definitions (OTG-IDENT-001)<br><br>Test User Registration Process (OTG-IDENT-002)<br><br>Test Account Provisioning Process (OTG-IDENT-003)<br><br>Testing for Account Enumeration and Guessable User Account (OTG-IDENT-004)<br><br>Testing for Weak or unenforced username policy (OTG-IDENT-005)|
|Authentication|Testing for Credentials Transported over an Encrypted Channel (OTG-AUTHN-001) <br><br>Testing for default credentials (OTG-AUTHN-002)<br><br>Testing for Weak lock out mechanism (OTG-AUTHN-003)<br><br>Testing for bypassing authentication schema (OTG-AUTHN-004)<br><br>Test remember password functionality (OTG-AUTHN-005)<br><br>Testing for Browser cache weakness (OTG-AUTHN-006)<br><br>Testing for Weak password policy (OTG-AUTHN-007)<br><br>Testing for Weak security question/answer (OTG-AUTHN-008)<br><br>Testing for weak password change or reset functionalities (OTG-AUTHN-009)<br><br>Testing for Weaker authentication in alternative channel (OTG-AUTHN-010)|
|Authorization|Testing Directory traversal/file include (OTG-AUTHZ-001)<br><br>Testing for bypassing authorization schema (OTG-AUTHZ-002)<br><br>Testing for Privilege Escalation (OTG-AUTHZ-003)<br><br>Testing for Insecure Direct Object References (OTG-AUTHZ-004)|
|Session Management|Testing for Bypassing Session Management Schema (OTG-SESS-001)<br><br>Testing for Cookies attributes (OTG-SESS-002)<br><br>Testing for Session Fixation (OTG-SESS-003)<br><br>Testing for Exposed Session Variables (OTG-SESS-004)<br><br>Testing for Cross Site Request Forgery (CSRF) (OTG-SESS-005)<br><br>Testing for logout functionality (OTG-SESS-006)<br><br>Test Session Timeout (OTG-SESS-007)<br><br>Testing for Session puzzling (OTG-SESS-008)|
|Input Validation|Testing for Reflected Cross Site Scripting (OTG-INPVAL-001)<br><br>Testing for Stored Cross Site Scripting (OTG-INPVAL-002)<br><br>Testing for HTTP Verb Tampering (OTG-INPVAL-003)<br><br>Testing for HTTP Parameter pollution (OTG-INPVAL-004)<br><br>Testing for SQL Injection (OTG-INPVAL-005)<br><br>Testing for LDAP Injection (OTG-INPVAL-006) <br><br>Testing for ORM Injection (OTG-INPVAL-007) <br><br>Testing for XML Injection (OTG-INPVAL-008) <br><br>Testing for SSI Injection (OTG-INPVAL-009) <br><br>Testing for XPath Injection (OTG-INPVAL-010) <br><br>IMAP/SMTP Injection (OTG-INPVAL-011) <br><br>Testing for Code Injection (OTG-INPVAL-012)<br><br>Testing for Local File Inclusion<br><br>Testing for Remote File Inclusion<br><br>Testing for Command Injection (OTG-INPVAL-013) <br><br>Testing for Buffer overflow (OTG-INPVAL-014)<br><br>Testing for Heap overflow<br><br>Testing for Stack overflow<br><br>Testing for Format string<br><br>Testing for incubated vulnerabilities (OTG-INPVAL-015) <br><br>Testing for HTTP Splitting/Smuggling (OTG-INPVAL-016)|
|Error Handling|Analysis of Error Codes (OTG-ERR-001)<br><br>Analysis of Stack Traces (OTG-ERR-002)|
|Weak Cryptography|Testing for Weak SSL/TLS Ciphers, Insufficient Transport Layer Protection (OTG-CRYPST-001) <br><br>Testing for Padding Oracle (OTG-CRYPST-002)<br><br>Testing for Sensitive information sent via unencrypted channels (OTG-CRYPST-003)|
|Businiess Logic|Test Business Logic Data Validation (OTG-BUSLOGIC-001) <br><br>Test Ability to Forge Requests (OTG-BUSLOGIC-002)<br><br>Test Integrity Checks (OTG-BUSLOGIC-003)<br><br>Test for Process Timing (OTG-BUSLOGIC-004)<br><br>Test Number of Times a Function Can be Used Limits (OTG-BUSLOGIC-005) <br><br>Testing for the Circumvention of Work Flows (OTG-BUSLOGIC-006)<br><br>Test Defenses Against Application Mis-use (OTG-BUSLOGIC-007)<br><br>Test Upload of Unexpected File Types (OTG-BUSLOGIC-008)<br><br>Test Upload of Malicious Files (OTG-BUSLOGIC-009)|
|Client Side|Testing for DOM based Cross Site Scripting (OTG-CLIENT-001) <br><br>Testing for JavaScript Execution (OTG-CLIENT-002)<br><br>Testing for HTML Injection (OTG-CLIENT-003)<br><br>Testing for Client Side URL Redirect (OTG-CLIENT-004) <br><br>Testing for CSS Injection (OTG-CLIENT-005)<br><br>Testing for Client Side Resource Manipulation (OTG-CLIENT-006) <br><br>Test Cross Origin Resource Sharing (OTG-CLIENT-007)<br><br>Testing for Cross Site Flashing (OTG-CLIENT-008)<br><br>Testing for Clickjacking (OTG-CLIENT-009)<br><br>Testing WebSockets (OTG-CLIENT-010) <br><br>Test Web Messaging (OTG-CLIENT-011) <br><br>Test Local Storage (OTG-CLIENT-012)|

## PTES
Following are the main sections defined by the standard as the basis for penetration testing execution:

- Pre-engagement Interactions
- Intelligence Gathering
- Threat Modeling
- Vulnerability Analysis
- Exploitation
- Post Exploitation
- Reporting

上面7个环节覆盖了渗透测试的整个生命周期，从开始前期交互到最终输出报告，每个环节之间做到了高内聚低耦合，非常适合渗透测试人员学习。

我们把渗透测试流程中的人员分成甲方和乙方，乙方就是提供渗透测试的服务方，甲方是需要渗透测试的需求方。为了达成服务交易，甲方需要给乙方支付费用。

该方法主要描述了乙方在给甲方做渗透测试服务整个生命周期，应该怎么做。

我们先来看看下表描述的每个环节的关键字
|PTES Section|Key Word|
|-|-|
|Pre-engagement Interactions|Scope, IP Ranges and Domains, Third Parties, Scoping Meeting, Scope Creep<br><br>Time Estimation, Additional Support Based on Hourly Rate, Start and End Dates<br><br>Questionnaires, General Questions<br><br>Acceptable Social Engineering<br><br>DoS Testing<br><br>Payment<br><br>Emergency Contact, Establish Lines of Communication|
|Intelligence Gathering|Identification and Naming of Target, Engagement limitations, time length, end goal<br><br>OSINT, Passive, Active<br><br>Physical, Metadata, Network, Financial, Employee<br><br>Identify Protection Mechanisms|
|Threat Modeling||
|Vulnerability Analysis||
|Exploitation||
|Post Exploitation||
|Reporting||
|||

# 参考/引用
【1】《Kali Linux 渗透测试的艺术》<br>
【2】[Penetration_testing_methodologies](https://www.owasp.org/index.php/Penetration_testing_methodologies)<br>
【3】[OSSTMM: Open Source Security Testing Methodology Manual](https://www.isecom.org/research.html#content5-9d)<br>
【4】*Information Systems Security Assessment Framework (ISSAF) draft 0.2.1*<br>
【5】*OWASP Testing Guide 4.0 Release*<br>
【6】[Cheat_Sheet:_Web_Application_Security_Frame](https://www.guidanceshare.com/wiki/Cheat_Sheet:_Web_Application_Security_Frame)<br>
【7】*The Penetration Testing Execution Standard Documentation Release 1.1*<br>
【8】[PTES Main Page](http://www.pentest-standard.org/index.php/Main_Page)<br>
【9】[CAPEC](https://capec.mitre.org/data/definitions/3000.html)<br>