<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <meta name="author" content="Hackerspirit"> <meta name="keywords" content="安全,读书笔记,2019"> <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="shortcut icon" href="http://imgs.yansu.org/site-favicon.ico" /> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://hackerspirit.org/2019/06/21/PTES%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>PTES读书笔记 | Hackerspirit</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="PTES读书笔记" /> <meta name="author" content="Hackerspirit" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="penetration testing execution standard" /> <meta property="og:description" content="penetration testing execution standard" /> <link rel="canonical" href="http://hackerspirit.org/2019/06/21/PTES%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html" /> <meta property="og:url" content="http://hackerspirit.org/2019/06/21/PTES%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html" /> <meta property="og:site_name" content="Hackerspirit" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2019-06-21T00:00:00+08:00" /> <script type="application/ld+json"> {"description":"penetration testing execution standard","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://hackerspirit.org/2019/06/21/PTES%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html"},"url":"http://hackerspirit.org/2019/06/21/PTES%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html","headline":"PTES读书笔记","datePublished":"2019-06-21T00:00:00+08:00","dateModified":"2019-06-21T00:00:00+08:00","author":{"@type":"Person","name":"Hackerspirit"},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <link type="application/atom+xml" rel="alternate" href="http://hackerspirit.org/feed.xml" title="Hackerspirit" /> <script src="/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar" class="open"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="http://imgs.yansu.org/site-avatar.png"/> </a> <div id="sidebar-social"> <a href="/pages/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:shuimuyq@gmail.com" class="sidebar-social-icon email"></a> <!-- Generate icon by yourself https://icomoon.io/app/#/select --> <a href="https://github.com/willalways" class="sidebar-social-icon github" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="recent">最新文章</li> <li class="sidebar-tag" data-filter="网络安全">网络安全</li> <li class="sidebar-tag" data-filter="信息技术">信息技术</li> <li class="sidebar-tag" data-filter="软件工程">软件工程</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="软件工程" href="/2019/06/21/%E5%8F%B0%E6%B9%BE%E6%B8%85%E5%8D%8E%E5%A4%A7%E5%AD%A6%E5%85%AC%E5%BC%80%E8%AF%BE-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html"> 台湾清华大学公开课：数据结构 </a> <a class="toc-link" data-tags="软件工程" href="/2019/06/21/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93_%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%81%8C%E4%B8%9A%E7%B4%A0%E5%85%BB_%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E5%89%AF%E6%9C%AC.html"> 《代码整洁之道 程序员的职业素养》读书笔记 </a> <a class="toc-link" data-tags="信息技术" href="/2019/06/21/%E8%87%AA%E5%B7%B1%E5%88%B6%E4%BD%9C%E6%A0%91%E8%8E%93%E6%B4%BE%E5%90%AF%E5%8A%A8%E7%9B%98.html"> 自己制作树莓派启动盘 </a> <a class="toc-link" data-tags="网络安全" href="/2019/06/21/PTES%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html"> PTES读书笔记 </a> </nav> </div> </aside> <main id="main" class="open"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2019 June 21</span> </div> <h1 class="post-title">PTES读书笔记</h1> <h1 id="penetration-testing-execution-standard">penetration testing execution standard</h1> <h2 id="0x01-high-level-organization-of-the-standard">0x01 High Level Organization of the Standard</h2> <p>The penetration testing execution standard consists of seven (7) main sections. These cover everything related to a penetration test.</p> <ul> <li> <p>from the initial communication and reasoning behind a pentest,</p> </li> <li> <p>through the intelligence gathering and threat modeling phases where testers are working behind the scenes in order to get a better understanding of the tested organization,</p> </li> <li> <p>through vulnerability research, exploitation and post exploitation, where the technical security expertise of the testers come to play and combine with the business understanding of the engagement,</p> </li> <li> <p>and finally to the reporting, which captures the entire process, in a manner that makes sense to the customer and provides the most value to it.</p> </li> </ul> <h2 id="0x02-pre-engagement-interactions">0x02 Pre-engagement Interactions</h2> <h3 id="21-overview">2.1 Overview</h3> <p>Remember, a penetration test should not be confrontational. It should not be an activity to see if the tester can “hack” you. It should be about identifying the business risk associated with and attack.</p> <h3 id="22-introduction-to-scope">2.2 Introduction to Scope</h3> <p>Neglecting to properly complete pre-engagement activities has the potential to open the penetration tester (or his firm) to a number of headaches including scope creep, unsatisfied customers, and even legal troubles.</p> <p>The scope of a project specifically defines what is to be tested. How each aspect of the test will be conducted will be covered in the Rules of Engagement section.</p> <p>One key component of scoping an engagement is outlining how the testers should spend their time.</p> <p>It is important in the Pre-Engagement phase that the tester is able to serve as a guide through what may be uncharted territory for a customer.</p> <p>The tester must understand the difference between a test which focuses on a single application with severe intensity and a test where the client provides a wide range of IP addresses to test and the goal is to simply find a way in.</p> <h3 id="23-metrics-for-time-estimation">2.3 Metrics for Time Estimation</h3> <p>Once the time to test is determined, it is a prudent practice to add 20% to the time.</p> <p>Another component of the metrics of time and testing is that every project needs to have a definitive drop dead date.</p> <p>All good projects have a well-defined beginning and end.</p> <h3 id="24-scoping-meeting">2.4 Scoping Meeting</h3> <p>The goal of the scoping meeting is to discuss what will be tested. Rules of engagement and costs will not be covered in this meeting.</p> <p>First, it needs to be established explicitly what IP ranges are in scope for the engagement. It is not uncommon for a client to be resistant and assume that it is the prerogative of the tester to identify their network and attack it, to make the test as realistic as possible. This would indeed be an ideal circumstance, however, possible legal ramifications must be considered above all else.</p> <h3 id="25-additional-support-based-on-hourly-rate">2.5 Additional Support Based on Hourly Rate</h3> <p>Any requests outside of the original scope should be documented in the form of a statement of work that clearly identifies the work to be done. We also recommend that it be clearly stated in the contract that additional work will be done for a flat fee per hour and explicitly state that additional work can not be completed until a signed and counter-signed SOW is in place.</p> <h3 id="27-general-questions">2.7 General Questions</h3> <p>2.7.1 Network Penetration Test 2.7.2 Web Application Penetration Test 2.7.3 Wireless Network Penetration Test 2.7.4 Physical Penetration Test 2.7.5 Social Engineering 2.7.6 Questions for Business Unit Managers 2.7.7 Questions for Systems Administrators</p> <h3 id="28-scope-creep">2.8 Scope Creep</h3> <p>do not hesitate to ask for additional funding to compensate for the extra time spent. If a customer refuses to pay for the extra work, it is almost never worth staying on to do that work.</p> <p>The second point is even more critical. When dealing with existing customers, take care to keep the prices lower. Taking advantage of a good situation by price gouging is a sure way to drive away repeat business.</p> <h3 id="29-specify-start-and-end-dates">2.9 Specify Start and End Dates</h3> <p>To mitigate this risk, add a simple statement to the contract which mentions that all retesting must be done within a certain timeframe after the final report delivery.</p> <h3 id="210-specify-ip-ranges-and-domains">2.10 Specify IP Ranges and Domains</h3> <p>Before starting a penetration test, all targets must be identified. These targets should be obtained from the customer during the initial questionnaire phase. Targets can be given in the form of specific IP addresses, network ranges, or domain names by the customer.</p> <h3 id="211-dealing-with-third-parties">2.11 Dealing with Third Parties</h3> <p>The most important thing to remember is that while permission may have been granted by the client, they do not speak for their third party providers. Thus, permission must be obtained from them as well in order to test the hosted systems. Failing to obtain the proper permissions brings with it, as always, the possibility of violating the law, which can cause endless headaches.</p> <p>2.11.1 Cloud Services 2.11.2 ISP 2.11.3 MSSPs Managed Security Service Providers also may need to be notified of testing. 2.11.4 Countries Where Servers are Hosted</p> <h3 id="212-define-acceptable-social-engineering-pretexts">2.12 Define Acceptable Social Engineering Pretexts</h3> <p>Be sure that any pretexts chosen for the test are approved in writing before testing is to begin.</p> <h3 id="213-dos-testing">2.13 DoS Testing</h3> <p>Stress testing or Denial of Service testing should be discussed before the engagement begins.</p> <p>if the organization is also worried about the availability of their services, then the stress testing should be conducted in a non-production environment which is identical to the production environment.</p> <h3 id="214-payment-terms">2.14 Payment Terms</h3> <p>2.14.1 Net 30 The total amount is due within 30 days of the delivery of the final report. This is usually associated with a per month percentage penalty for non-payment. This can be any number of days you wish to grant your customers (i.e. 45, or 60).</p> <p>2.14.2 Half Upfront It is not uncommon to require half of the total bill upfront before testing begins. This is very common for longer-term engagements.</p> <p>2.14.3 Recurring A recurring payment schedule is more commonly used for long-term engagements. For example, some engagements may span as far as a year or two. It is not at all uncommon to have the customer pay in regular installments throughout the year.</p> <h3 id="215-goals">2.15 Goals</h3> <p>Every penetration test should be goal-oriented. This is to say that the purpose of the test is to identify specific vulnerabilities that lead to a compromise of the business or mission objectives of the customer. It is not about finding un-patched systems. It is about identifying risk that will adversely impact the organization.</p> <p>2.15.1 Primary The primary goal of a test should not be driven by compliance.</p> <p>2.15.2 Secondary The secondary goals are directly related to compliance.</p> <p>2.15.3 Business Analysis Before performing a penetration test it is beneficial to determine the maturity level of the client’s security posture For customers with a very immature security program, it is often a good idea to perform a vulnerability analysis first.</p> <p>Some testers believe there is a stigma surrounding Vulnerability Analysis (VA) work. Those testers have forgotten that the goal is to identify risks in the target organization, not about pursuing the so-called “rockstar” lifestyle. If a company is not ready for a full penetration test, they will get far more value out of a good VA than a penetration test.</p> <p>Establish with the customer in advance what information about the systems they will be providing. It may also be helpful to ask for information about vulnerabilities which are already documented. This will save the testers time and save the client money by not overlapping testing discoveries with known issues. Likewise, a full or partial white-box test may bring the customer more value than a black-box test, if it isn’t absolutely required by compliance.</p> <h3 id="216-establish-lines-of-communication">2.16 Establish Lines of Communication</h3> <p>One of the most important aspects of any penetration test is communication with the customer. How often you interact with the customer, and the manner in which you approach them, can make a huge difference in their feeling of satisfaction.</p> <h3 id="217-emergency-contact-information">2.17 Emergency Contact Information</h3> <p>Obviously, being able to get in touch with the customer or target organization in an emergency is vital. Emergencies may arise, and a point of contact must have been established in order to handle them.</p> <p>2.17.1 Incident Reporting Process 2.17.2 Incident Definition 2.17.3 Status Report Frequency 2.17.4 PGP and Other Alternatives</p> <h3 id="218-rules-of-engagement">2.18 Rules of Engagement</h3> <p>2.18.1 Timeline A clear timeline should be established for the engagement. While scope defines the start and the end of an engagement, the rules of engagement define everything in between.</p> <p>GANTT Charts and Work Breakdown Structures are often used to define the work and the amount of time that each specific piece of the work will take. Seeing the schedule broken down in this manner aids those involved in identifying where resources need to be applied and it helps the customer identify possible roadblocks which many be encountered during testing</p> <p>2.18.2 Locations Another parameter of any given engagement which is important to establish with the customer ahead of time is any destinations to which the testers will need to travel during the test. This could be as simple as identifying local hotels, or complex as identifying the applicable laws of a specific target country.</p> <p>However, if the data cannot be physically or virtually obtained, how can it be proved that the testers indeed obtained access to the information? This problem has been solved in a number of ways. There are ways to prove that the vault door was opened without taking any of the money. For instance, a screenshot of database schema and file permissions can be taken, or the files themselves can be displayed without opening them to displaying the content, as long as no PII is visible in the filenames themselves.</p> <p>2.18.3 Evidence Handling When handling evidence of a test and the differing stages of the report it is incredibly important to take extreme care with the data. Always use encryption and sanitize your test machine between tests. Never hand out USB sticks with test reports out at security conferences. And whatever you do, don’t re-use a report from another customer engagement as a template! It’s very unprofessional to leave references to another organization in your document.</p> <p>2.18.4 Regular Status Meetings Throughout the testing process it is critical to have regular meetings with the customer informing them of the overall progress of the test. These meetings should be held daily and should be as short as possible. Meetings should be kept to three concepts: plans, progress and problems. Plans are generally discussed so that testing is not conducted during a major unscheduled change or an outage. Progress is simply an update to the customer on what has been completed so far. Problems should also be discussed in this meeting, but in the interest of brevity, conversations concerning solutions should almost always be taken offline</p> <p>2.18.5 Time of the Day to Test Certain customers require all testing to be done outside of business hours. This can mean late nights for most testers. The time of day requirements should be well established with the customer before testing begins.</p> <p>2.18.6 Dealing with Shunning</p> <p>2.18.7 Permission to Test One of the most important documents which need to be obtained for a penetration test is the Permission to Test document. This document states the scope and contains a signature which acknowledges awareness of the activities of the testers.</p> <p>2.18.8 Legal Considerations Some activities common in penetration tests may violate local laws. For this reason, it is advised to check the legality of common pentest tasks in the location where the work is to be performed. For example,any VOIP calls captured in the course of the penetration test may be considered wiretapping in some areas.</p> <h3 id="219-capabilities-and-technology-in-place">2.19 Capabilities and Technology in Place</h3> <p>Good penetration tests do not simply check for un-patched systems. They also test the capabilities of the target organization. To that end, below is a list of things that you can benchmark while testing.</p> <ol> <li>Ability to detect and respond to information gathering</li> <li>Ability to detect and respond to foot printing</li> <li>Ability to detect and respond to scanning and vuln analysis</li> <li>Ability to detect and respond to infiltration (attacks)</li> <li>Ability to detect and respond to data aggregation</li> <li> <p>Ability to detect and respond to data ex-filtration</p> <p>When tracking this information be sure to collect time information. For example, if a scan is detected you should be notified and note what level of scan you were preforming at the time.</p> </li> </ol> <h2 id="0x03-intelligence-gathering">0x03 Intelligence Gathering</h2> <h3 id="31-general">3.1 General</h3> <p>Levels are an important concept for this document and for PTES as a whole. It’s a maturity model of sorts for pentesting. Defining levels allows us to clarify the expected output and activities within certain real-world constraints such as time, effort, access to information, etc.</p> <p>Level 1 Information Gathering (think: Compliance Driven) Mainly a click-button information gathering process. This level of information can be obtained almost entirely by automated tools. Bare minimum to say you did IG for a PT.</p> <p>Level 2 Information Gathering (think: Best Practice) This level can be created using automated tools from level 1 and some manual analysis. A good understanding of the business, including information such as physical location, business relationships, org chart, etc.</p> <p>Level 3 Information Gathering (think: State Sponsored) More advanced pentest, Redteam, full-scope. All the info from level 1 and level 2 along with a lot of manual analysis. An Army Red Team is tasked to analyze and attack a segment of the Army’s network in a foreign country to find weaknesses that could be exploited by a foreign national. A level 3 information gathering effort would be appropriate in this case.</p> <h3 id="32-intelligence-gathering">3.2 Intelligence Gathering</h3> <p>3.2.1 What it is Intelligence Gathering is performing reconnaissance against a target to gather as much information as possible to be utilized when penetrating the target during the vulnerability assessment and exploitation phases. The more information you are able to gather during this phase, the more vectors of attack you may be able to use in the future. Open source intelligence (OSINT) is a form of intelligence collection management that involves finding, selecting, and acquiring information from publicly available sources and analyzing it to produce actionable intelligence. 1 3.2.2 Why do it We perform Open Source Intelligence gathering to determine various entry points into an organization. These entry points can be physical, electronic, and/or human. Many companies fail to take into account what information about themselves they place in public and how this information can be used by a determined attacker. On top of that many employees fail to take into account what information they place about themselves in public and how that information can be used to to attack them or their employer. 3.2.3 What is it not OSINT may not be accurate or timely. The information sources may be deliberately/accidentally manipulated to reflect erroneous data, information may become obsolete as time passes, or simply be incomplete. It does not encompass dumpster-diving or any methods of retrieving company information off of physical items found on-premises.</p> <h3 id="33-target-selection">3.3 Target Selection</h3> <p>3.3.1 Identification and Naming of Target It is also not all that uncommon for a company to have a number of sub-companies underneath them. For example General Electric and Proctor and Gamble own a great deal of smaller companies.</p> <p>3.3.2 Consider any Rules of Engagement limitations 3.3.3 Consider time length for test 3.3.4 Consider end goal of the test Every test has an end goal in mind - a particular asset or process that the organization considers critical. Having the end result in mind, the intelligence gathering phase should make sure to include all secondary and tertiary elements surrounding the end goal. Be it supporting technologies, 3rd parties, relevant personnel, etc… Making sure the focus is kept on the critical assets assures that lesser relevant intelligence elements are de-prioritized and categorized as such in order to not intervene with the analysis process.</p> <h3 id="34-osint">3.4 OSINT</h3> <p>Open Source Intelligence (OSINT) takes three forms; Passive, Semi-passive, and Active.</p> <h3 id="35-covert-gathering">3.5 Covert Gathering</h3> <h3 id="36-footprinting">3.6 Footprinting</h3> <h3 id="37-identify-protection-mechanisms">3.7 Identify Protection Mechanisms</h3> <h2 id="0x04-threat-modeling">0x04 Threat Modeling</h2> <h3 id="41-general">4.1 General</h3> <p>The standard focuses on two key elements of traditional threat modeling - assets and attacker (threat community/agent). Each one is respectively broken down into business assets and business processes and the threat communities and their capabilities.</p> <p>As a minimum, all four elements should be clearly identified and documented in every penetration test.</p> <p>The model should be clearly documented, and be delivered as part of the final report as the findings in the report will reference the threat model in order to create a more accurate relevance and risk score that is specific to the organization (rather than a generic technical one).</p> <p>4.1.1 High level threat modeling process 1. Gather relevant documentation 2. Identify and categorize primary and secondary assets 3. Identify and categorize threats and threat communities 4. Map threat communities against primary and secondary assets</p> <p>There are a variety of tools available to identify targets and map attack vectors. These normally focus on the business assets (what systems to target) and business processes (how to attack them.)</p> <h3 id="42-business-asset-analysis">4.2 Business Asset Analysis</h3> <p>4.2.1 Organizational Data Policies, Plans, and Procedures Product Information (e.g. trade secrets, R&amp;D data) Marketing Information (plans, roadmaps, etc.) Financial Information (e.g. bank, credit, equity accounts) Technical Information • Infrastructure Design Information • System Configuration Information • User Account Credentials • Privileged User Account Credentials</p> <p>Employee Data Customer Data</p> <p>4.2.2 Human Assets • Executive Management • Executive Assistants • Middle Management • Administrative Assistants • Technical/Team Leads • Engineers • Technicians • Human Resources</p> <h3 id="43-business-process-analysis">4.3 Business Process Analysis</h3> <p>By mapping these processes, identifying the critical vs. non-critical processes and eventually finding flaws in them we are able to understand how the business works, what makes them money and eventually how specific threat communities can make them lose money.</p> <p>4.3.1 Technical infrastructure supporting process As business processes are usually supported by IT infrastructure (such as computer networks, processing power, PCs for entering information and managing the business process, etc…), all those elements must be identified and mapped. Such mapping should be clear enough to be used later on in the process when translating the threat model to the vulnerability mapping and exploitation.</p> <p>4.3.2 Information assets supporting process 4.3.3 Human assets supporting process 4.3.4 3rd party integration and/or usage of/by process</p> <h3 id="44-threat-agentscommunity-analysis">4.4 Threat Agents/Community Analysis</h3> <h3 id="45-threat-capability-analysis">4.5 Threat Capability Analysis</h3> <h3 id="46-motivation-modeling">4.6 Motivation Modeling</h3> <h2 id="0x05-vulnerability-analysis">0x05 Vulnerability Analysis</h2> <h3 id="51-testing">5.1 Testing</h3> <p>Vulnerability testing is the process of discovering flaws in systems and applications which can be leveraged by an attacker. These flaws can range anywhere from host and service misconfiguration, or insecure application design.Although the process used to look for flaws varies and is highly dependent on the particular component being tested, some key principals apply to the process.</p> <p>When conducting vulnerability analysis of any type the tester should properly scope the testing for applicable depth and breadth to meet the goals and/or requirements of the desired outcome. Depth values can include such things as the location of an assessment tool, authentication requirements, etc. For example; in some cases it maybe the goal of the test to validate mitigation is in place and working and the vulnerability is not accessible; while in other instances the goal maybe to test every applicable variable with authenticated access in an effort to discover all applicable vulnerabilities. Whatever your scope, the testing should be tailored to meet the depth requirements to reach your goals. Depth of testing should always be validated to ensure the results of the assessment meet the expectation (i.e. did all the machines authenticate, etc.). In addition to depth, breadth must also be taken into consideration when conducting vulnerability testing. Breadth values can include things such as target networks, segments, hosts, application, inventories, etc. At its simplest element, your testing may be to find all the vulnerabilities on a host system; while in other instances you may need to find all the vulnerabilities on hosts with in a given inventory or boundary. Additionally breadth of testing should always be validated to ensure you have met your testing scope (i.e. was every machine in the inventory alive at the time of scanning? If not, why).</p> <h3 id="52-active">5.2 Active</h3> <p>There are two distinct ways to interact with the target component: automated, and manual.</p> <p>Automated Automated testing utilizes software to interact with a target, examine responses, and determine whether a vulnerability exists based on those responses.</p> <p>Network/General Vulnerability Scanners Port Based When the scanner determines that a port is open, a presumption is made by the scanner as to whether a vulnerability is present or not. For example, if a port based scanner connects to TCP port 23, and that port is listening, the scanner is likely to report that the telnet service is available on the remote host, and flag it as having a clear text authentication protocol enabled.</p> <p>Service Based</p> <p>Banner Grabbing</p> <p>Web Application Scanners General application flaw scanners Most web application scans start with the address of a website, web application, or web service. The scanner then crawls the site by following links and directory structures. After compiling a list of webpages, resources, services and/or other media offered, the scanner will perform tests, or audits against the results of the crawl. For example, if a webpage discovered in the crawl has form fields, the scanner might attempt SQL injection or cross-site scripting. If the crawled page contained errors, the scanner might look for sensitive information displayed in the error detail, and so on.</p> <p>Directory Listing/Brute Forcing</p> <p>Web Server Version/Vulnerability Identification Methods OPTIONS PUT/DELETE TRACE/TRACK</p> <p>Network Vulnerability Scanners/Specific Protocols VPN Voice Network Scanners War Dialing VoIP</p> <p>Manual Direct Connections As with any automated process or technology, the margin for error always exists. Instabilities in systems, network devices and network connectivity may introduce inaccurate results during testing. It is always recommended to execute manual direct connections to each protocol or service available on a target system to validate the results of automated testing as well as identifying all potential attack vectors and previously unidentified weaknesses.</p> <p>Obfuscated Multiple Exit Nodes Security monitoring and defense systems operate under the pretense of identifying malicious activity from a specific IP address. In situations where Intrusion Detection systems are deployed and monitoring activity, sourcing assessment and attack activities from multiple IP addresses provide more accurate results and lessen the opportunity for a monitoring device on a target network to identify and respond.</p> <p>IDS Evasion When conducting assessment activities against a target environment where IDS technologies are deployed, it may be necessary to perform evasion. Using methods such as string manipulation, polymorphism, session splicing, and fragmentation can provide more accurate results while bypassing signature matching patterns implemented in IDS devices.</p> <h3 id="53-passive">5.3 Passive</h3> <p>Metadata Analysis Though metadata is quite common on documents located on a company’s internal network, companies should take care to purge metadata before making documents available to the public, or on the public Internet. For this reason, any metadata an attacker could gain access to passively (without directly attacking the target) should be considered a security issue.</p> <p>Traffic Monitoring</p> <h3 id="54-validation">5.4 Validation</h3> <p>Correlation between Tools When working with multiple tools the need for correlation of findings can become complicated. Correlation can be broken down into two distinct styles, specific and categorical correlation of items, both are useful based on the type of information, metrics and statistics you are trying to gather on a given target.</p> <p>Manual Testing/Protocol Specific</p> <p>Attack Avenues Creation of attack trees During a security assessment, it is crucial to the accuracy of the final report to develop an attack tree as testing progresses throughout the engagement. As new systems, services and potential vulnerabilities are identified; an attack tree should be developed and regularly updated. This is especially important during the exploitation phases of the engagement as one point of entry that materializes could be repeated across other vectors mapped out during the development of the attack tree.</p> <p>Isolated Lab Testing The accuracy of vulnerability analysis and exploitation is substantially greater when replicated environments are setup in an isolated lab. Often times, systems may be hardened with specific control sets or additional protection mechanisms. By designing a lab that mimics that of the target organization, the consultant can ensure that the vulnerabilities identified and exploits attempted against the desired targets are reliable and lessen the opportunity for inaccurate results or system inoperability.</p> <p>Visual Confirmation Manual Connection with Review</p> <h3 id="55-research">5.5 Research</h3> <p>Public Research Vulnerability Databases Vendor Advisories</p> <p>Exploit Databases and Framework Modules Common/default Passwords Hardening Guides/Common Misconfigurations</p> <p>Private Research Setting up a replica environment Testing Configurations</p> <p>Fuzzing Fuzzing, or fault injection, is a brute-force technique for finding application flaws by programmatically submitting valid, random or unexpected input to the application. The basic process involves attaching a debugger to the target application, and then running the fuzzing routine against specific areas of input and then analyzing the program state following any crashes. Many fuzzing applications are available, although some testers write their own fuzzers for specific targets.</p> <p>Identifying potential avenues/vectors Log in or connect to a target network application to identify commands and other areas of input. If the target is a desktop application that reads files and/or web pages, analyze the accepted file formats for avenues of data input. Some simple tests involve submitting invalid characters, or very long strings of characters to cause a crash. Attach a debugger to analyze the program state in the event of a successful crash.</p> <p>Disassembly and code analysis Some programming languages allow for decompilation, and some specific applications are compiled with symbols for debugging. A tester can take advantage of these features to analyze program flow and identify potential vulnerabilities. Source code for open source applications should be analyzed for flaws. Web applications written in PHP share many of the same vulnerabilities, and their source code should be examined as part of any test.</p> <h2 id="0x06-exploitation">0x06 Exploitation</h2> <h3 id="61-purpose">6.1 Purpose</h3> <p>The exploitation phase of a penetration test focuses solely on establishing access to a system or resource by bypassing security restrictions. If the prior phase, vulnerability analysis was performed properly, this phase should be well planned and a precision strike.. The main focus is to identify the main entry point into the organization and to identify high value target assets. If the vulnerability analysis phase was properly completed, a high value target list should have been complied. Ultimately the attack vector should take into consideration the success probability and highest impact on the organization.</p> <h3 id="62-countermeasures">6.2 Countermeasures</h3> <p>Countermeasures are defined as preventative technology or controls that hinder the ability to successfully complete an exploit avenue. This technology could be a Host Based Intrusion Prevention System, Security Guard, Web Application Firewall, or other preventative methods. When performing an exploit, several factors should be taken into consideration.</p> <p>6.2.1 Anti-Virus Encoding / Packing / Encrypting / Whitelist Bypass / Process Injection / Purely Memory Resident</p> <p>6.2.2 Human 6.2.3 Data Execution Prevention (DEP) 6.2.4 Address Space Layout Randomization 6.2.5 Web Application Firewall (WAF)</p> <h3 id="63-evasion">6.3 Evasion</h3> <p>Evasion is the technique used in order to escape detection during a penetration test. This could be circumventing a camera system as to not be seen by a guard, obfuscating your payloads to evade Intrusion Detection Systems (IDS) or Intrusion Prevention Systems (IPS) or encoding requests/responses to circumvent web application firewalls. Overall, the need to identify a low risk scenario for evading a technology or person should be formulated prior to the exploit.</p> <h3 id="64-precision-strike">6.4 Precision Strike</h3> <p>The main focus of a penetration test is to simulate an attacker in order to represent a simulated attack against the organization. The value brought through a penetration test is generally not through smash and grab techniques where the attacks are noisy in nature and in an attempt to try every exploit. This approach may be particularly useful at the end of a penetration test to gauge the level of incident response from the organization, but in most cases the exploitation phase is a accumulation of specific research on the target.</p> <h3 id="65-customized-exploitation-avenue">6.5 Customized Exploitation Avenue</h3> <p>Every attack will typically not be the same in how the exploitation avenue occurs. In order to be successful in this phase, the attack should be tailored and customized based on the scenario. For example, if a wireless penetration test is occurred, and a specific technology is in use, these need to be identified and attacked based on what technologies are in place. Having a clear understanding of each scenario and the applicability of an exploit is one of the most important aspects of this phase of the penetration test.</p> <h3 id="66-tailored-exploits">6.6 Tailored Exploits</h3> <p>The penetration tester should have the knowledge in place to be able to customize an exploit and the ability to change on the fly in order to successfully complete the attack.</p> <p>6.6.1 Exploit Customization A common theme for exploits is to target specific versions of operating systems or applications.</p> <h3 id="67-zero-day-angle">6.7 Zero-Day Angle</h3> <p>This type of attack often represents a highly advanced organization that can handle a focused attack against the organization through normal attack methods. In certain scenarios research may be conducted in order to reverse engineer, fuzz, or perform advanced discovery of vulnerabilities that have not been discovered.</p> <p>6.7.1 Fuzzing 6.7.2 Source Code Analysis 6.7.3 Types of Exploits Buffer Overflows / SEH Overwrites (structured exception handler ) / Return Oriented Programming 6.7.4 Traffic Analysis 6.7.5 Physical Access Human Angle / PC Access 6.7.6 Proximity Access (WiFi) WiFi Attacks / Attacking the User There are several common techniques in use of this, but most commonly the attacker would setup a wireless access point with the same name or an enticing name in order for the victim to connect.</p> <h3 id="68-example-avenues-of-attack">6.8 Example Avenues of Attack</h3> <p>Web Application Attacks Social-Engineering Physical Attack Avenues Memory Based Exploits (i.e. buffer/heap overflows, memory corruptions, use-after-free). Man in the Middle VLAN Hopping USB/Flash Drive deployment Reverse Engineering Zero-Day Angle Attacking the user Encryption Cracking Graphics Processing Unit (GPU) Cracking Traffic Analysis Firewire Routing protocols Phishing with Pretexting Employee Impersonation</p> <h3 id="69-overall-objective">6.9 Overall Objective</h3> <p>In the pre-engagement interaction phase with the customer, a clear definition of the overall objectives of the penetration test should have been communicated. In the case of the exploitation phase, the biggest challenge is identifying the least path of resistance into the organization without detection and having the most impact on the organizations ability to generate revenue. By performing the prior phases properly, a clear understanding of how the organization functions and makes money should be relatively understood. From the exploitation phase and into the post-exploitation phase, the attack vectors should rely solely on the mission of circumventing security controls in order to represent how the organization can suffer substantial losses through a targeted attack against the organization.</p> <h2 id="0x07-post-exploitation">0x07 Post Exploitation</h2> <h3 id="71-purpose">7.1 Purpose</h3> <p>The purpose of the Post-Exploitation phase is to determine the value of the machine compromised and to maintain control of the machine for later use. The value of the machine is determined by the sensitivity of the data stored on it and the machines usefulness in further compromising the network. The methods described in this phase are meant to help the tester identify and document sensitive data, identify configuration settings, communication channels, and relationships with other network devices that can be used to gain further access to the network, and setup one or more methods of accessing the machine at a later time. In cases where these methods differ from the agreed upon Rules of Engagement, the Rules of Engagement must be followed.</p> <h3 id="72-rules-of-engagement">7.2 Rules of Engagement</h3> <p>7.2.1 Protect the Client Unless previously agreed upon, there will be no modification of services which the client deems “critical” to their infrastructure. All modifications, including configuration changes, executed against a system must be documented. 。。。</p> <p>7.2.2 Protecting Yourself Ensure that the contract and/or statement of work signed by both the client and provider that the actions taken on the systems being tested are on behalf and in representation of the client. 。。。</p> <h3 id="73-infrastructure-analysis">7.3 Infrastructure Analysis</h3> <p>7.3.1 Network Configuration 7.3.2 Network Services</p> <h3 id="74-pillaging">7.4 Pillaging</h3> <p>Pillaging refers to obtaining information (i.e. files containing personal information, credit card information, passwords, etc.) from targeted hosts relevant to the goals defined in the pre-assessment phase. This information could be obtained for the purpose of satisfying goals or as part of the pivoting process to gain further access to the network. The location of this data will vary depending on the type of data, role of the host and other circumstances. Knowledge and basic familiarity with commonly used applications, server software and middleware is very important, as most applications store their data in many different formats and locations. Special tools may be necessary to obtain, extract or read the targeted data from some systems.</p> <p>7.4.1 Installed Programs • List of the applications and their associated versions installed on the system. • List of operating system updates applied to the system.</p> <p>7.4.2 Installed Services Services on a particular host may serve the host itself, or other hosts in the target network. It is necessary to create a profile of each targeted host, noting the configuration of these services, their purpose, and how they may potentially be used to achieve assessment goals or further penetrate the network.</p> <p>（Security Services；File/Printer Shares ；Database Servers ；Directory Servers ；Name Servers ；Deployment Services ；Certificate Authority ；Source Code Management Server ；Dynamic Host Configuration Server ；Dynamic Host Configuration Server （DHCP）；Virtualization ；Messaging ；Monitoring and Management ；Backup Systems ；Networking Services (RADIUS,TACACS..etc) ）</p> <p>7.4.3 Sensitive Data （Key-logging ；Screen capture ；Network traffic capture ；Previous Audit reports ）</p> <p>7.4.4 User Information In this section the main focus is on the information present on the target system related to user accounts either present on the system or that have connected remotely and have left some trace that the personnel performing the assessment can gather and analyze for further penetration or provide the desired goal of the assessment.</p> <p>On System General information that can be gather on a compromised system are: • History files ； • Encryption Keys (SSH, PGP/GPG) ； • Interesting Documents (.doc/x, .xls/x , password.*) ； • User specific application configuration parameters • Individual Application History (MRU Windows only, history files..etc) • Enumerate removable media • Enumerate network shares / domain permission (gpresult)</p> <p>Web Browsers</p> <p>IM Clients • Enumerate Account Configuration (User, Password, Server, Proxy) • Chat Logs</p> <p>7.4.5 System Configuration Password Policy Security Policies Configured Wireless Networks and Keys</p> <h3 id="75-high-valueprofile-targets">7.5 High Value/Profile Targets</h3> <h3 id="76-data-exfiltration">7.6 Data Exfiltration</h3> <p>7.6.1 Mapping of all possible exfiltration paths 7.6.2 Testing exfiltration paths 7.6.3 Measuring control strengths</p> <h3 id="77-persistence">7.7 Persistence</h3> <p>• Installation of backdoor that requires authentication. • Installation and/or modification of services to connect back to system. User and complex password should be used as a minimum; use of certificates or cryptographic keys is preferred where possible. (SSH, ncat, RDP). Reverse connections limited to a single IP may be used. • Creation of alternate accounts with complex passwords. • When possible backdoor must survive reboots.</p> <h3 id="78-further-penetration-into-infrastructure">7.8 Further Penetration Into Infrastructure</h3> <p>7.8.1 From Compromised System Actions that can be taken from a compromised system: • Upload tools • Use local system tools • ARP Scan • Ping Sweep • DNS Enumeration of internal network • Directory Services Enumeration • Brute force attacks • Enumeration and Management thru Management Protocols and compromised credentials (WinRM, WMI, SMB, SNMP..etc) • Abuse of compromised credentials and keys (Webpages, Databases..etc) • Execute Remote Exploits</p> <p>7.8.2 Thru Compromised System Actions that can be taken thru a compromised system: • Port Forwarding • Proxy to internal network (SSH) • VPN to internal network • Execute Remote Exploit • Abuse of compromised credentials and keys (Webpages, Databases..etc)</p> <h3 id="79-cleanup">7.9 Cleanup</h3> <p>The cleanup process covers the requirements for cleaning up systems once the penetration test has been completed. This will include all user accounts and binaries used during the test. • Remove all executable, scripts and temporary file from a compromised system. If possible use secure delete method for removing the files and folders. • Return to original values system settings and application configuration parameters if they where modified during the assessment. • Remove all backdoors and/or rootkits installed. • Remove any user accounts created for connecting back to compromise systems.</p> <h2 id="0x08-reporting">0x08 Reporting</h2> <h3 id="82-report-structure">8.2 Report Structure</h3> <p>The report is broken down into two (2) major sections in order to communicate the objectives, methods, and results of the testing conducted to various audiences.</p> <h3 id="83-the-executive-summary">8.3 The Executive Summary</h3> <p>Background: Overall Posture: Risk Ranking/Profile: General Findings: Recommendation Summary: Strategic Roadmap:</p> <h3 id="84-technical-report">8.4 Technical Report</h3> <p>Introduction: The introduction section of the technical report is intended to be an initial inventory of: • Personnel involved in the testing from both the Client and Penetration Testing Team • Contact information • Assets involved in testing • Objectives of Test • Scope of Test • Strength of Test • Approach • Threat/Grading Structure</p> <p>Information Gathering:</p> <p>Vulnerability Assessment:</p> <p>Exploitation/ Vulnerability Confirmation:</p> <p>Post Exploitation:</p> <p>Post Exploitation: • Privilege Escalation path – Technique used • Acquisition of Critical Information Defined by client • Value of information • Access to core business systems • Access to compliance protected data sets • Additional Information/Systems Accessed • Ability of persistence • Ability for exfiltration • Countermeasure Effectiveness</p> <p>Risk/Exposure:</p> <p>Conclusion:</p> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://hackerspirit.org/2019/06/21/PTES%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html&text=PTES读书笔记" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://hackerspirit.org/2019/06/21/PTES%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html&title=PTES读书笔记" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://hackerspirit.org/2019/06/21/PTES%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html&title=PTES读书笔记" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="comment container"> <div id="disqus_thread"> </div> </div> <div class="footer"> <div class="container"> <p class="footer-entry">All content is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></p> <p class="footer-entry">Built with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll theme</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> </main> <button id="menu" class="open"> <span id="menu-icons"></span> </button> <button id="post-toc-menu"> <span id="post-toc-menu-icons"></span> </button> <div id="post-toc"> <span id="post-toc-title">Table of Contents</span> <ul id="post-toc-ul"></ul> </div> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> </body> </html>
